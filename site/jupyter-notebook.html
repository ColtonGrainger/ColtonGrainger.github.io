<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width">
  <title>Jupyter Notebook Configuration (Colton Grainger)</title>
  

  <style type="text/css">
    /* License: CC0 */

@import url('https://fonts.googleapis.com/css?family=Fira+Sans');
@import url('https://fonts.googleapis.com/css?family=Inconsolata');

body {
  font-family: "Fira Sans", sans-serif ;
  color: #333333 ;
}

main, footer {
  line-height: 1.4;
  margin: auto;
  max-width: 40rem;
  text-align: left;
  width: 93%;
  word-wrap: break-word;
}

footer { font-size: 80%; }

nav#site_navigation {
    font-size: 80%;
    /* See http://stackoverflow.com/a/324553 ; this ensures that the
     navigation links (left side) and search bar (right side) play
     nicely */
    overflow: hidden;
}

div#toc {
    font-size: 80%;
}

dl#yaml_header_data {
    font-size: 80%;
}

h1 { text-transform: uppercase; }
h2 { border-bottom: 1px solid #ccc; }
h1, h2, h3, h4, h5, h6 { 
  font-family: "fira sans", sans-serif ;
  font-size: 120%;
  font-weight: normal;
}

a { color: BlueViolet; text-decoration: none; }
a:visited { color: #b58900; }
a:hover, a:active { text-decoration:underline; }
a.anchorjs-link:hover, a.anchorjs-link:active { text-decoration: none; }

blockquote {
    border-left: 0.25em solid #ccc;
    margin: 0px;
    padding-left: 1.5em;
}

code {
    font-family: "Inconsolata",monospace;
    color: #586e75;
    background-color: #f6f6f6;
    padding-left: 0.1em;
    padding-right: 0.1em;
    word-wrap: normal;
    border-radius: 0.2em;
}

pre code {
    display: block;
    line-height: 1.2;
    max-height: 400px;
    overflow: auto;
    padding: 0.5em;
}

pre {
    font-family: inherit;
    line-height: 1.4;
}

table {
    border-bottom: 2px solid #333;
    border-collapse: collapse;
    border-top: 2px solid #333;
    margin: 0px auto; /* center table */
}

table th {
    border-bottom: 1px solid #333;
    font-weight: normal;
    padding: 0px 10px;
    vertical-align: top;
}

table td {
    padding: 0px 10px;
    vertical-align: top;
}

li {
  margin-top: 0.3em;
  margin-bottom: 0.3em; 
}

@media screen and (max-width: 40rem) {
    html { 
      font-size: 80%; 
    }
    main { 
      padding-left: 5px ;
      padding-right: 5px ;
    }
    body { 
      padding: 0px; 
    }
}

    .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #586e75;
}
.highlight .err {
  color: #002b36;
  background-color: #dc322f;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #657b83;
}
.highlight .cp {
  color: #b58900;
}
.highlight .nt {
  color: #b58900;
}
.highlight .o, .highlight .ow {
  color: #93a1a1;
}
.highlight .p, .highlight .pi {
  color: #93a1a1;
}
.highlight .gi {
  color: #859900;
}
.highlight .gd {
  color: #dc322f;
}
.highlight .gh {
  color: #268bd2;
  background-color: #002b36;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #6c71c4;
}
.highlight .kc {
  color: #cb4b16;
}
.highlight .kt {
  color: #cb4b16;
}
.highlight .kd {
  color: #cb4b16;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #859900;
}
.highlight .sr {
  color: #2aa198;
}
.highlight .si {
  color: #d33682;
}
.highlight .se {
  color: #d33682;
}
.highlight .nn {
  color: #b58900;
}
.highlight .nc {
  color: #b58900;
}
.highlight .no {
  color: #b58900;
}
.highlight .na {
  color: #268bd2;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #859900;
}
.highlight .ss {
  color: #859900;
}

  </style>
</head>

<body>
<nav id="site_navigation">
  <!--
    See
      http://stackoverflow.com/questions/37103/css-make-divs-align-horizontally
    for how the div elements are managed.
  -->
   <div style="float:left;">
     <a href="https://coltongrainger.com">about</a>
     | <a href="https://raw.githubusercontent.com/coltongrainger/blog/master/_posts/2018-03-04-jupyter-notebook.md">source</a>
     | <a href="https://github.com/coltongrainger/blog/commits/master/_posts/2018-03-04-jupyter-notebook.md">history</a>
  </div>
  <div style="float:right;">
    <!--
      See
        - http://stackoverflow.com/a/13379065/3422337
        - http://kaspars.net/blog/wordpress/how-to-add-google-site-search
        - http://www.vanderbilt.edu/searchsupport/code-samples.php
    -->
    <form name="google-search" action="https://google.com/search" method="get">
      <fieldset style="border:0;">
        <input type="hidden" name="sitesearch" value="https://coltongrainger.com" />
        <input name="q" type="text" />
        <input type="submit" name="btnG" value="search" />
      </fieldset>
    </form>
  </div>
</nav>

  <script src="/assets/js/anchor.min.js"></script>
  <main>

  <h1> Jupyter Notebook Configuration </h1>
  <dl id="yaml_header_data">
    
      <dt>date: 2018-03-04</dt>
    

    
      <dt>revised: 2018-07-16</dt>
    

    

    
  </dl>

  <p><em>Update: while notebooks usefully package code, kernel, and exposition, putting content into the <code class="highlighter-rouge">ipynb</code> qua <code class="highlighter-rouge">json</code> format is (or should be) the last step in my workflow.</em></p>

<p>Why? Rather than tooling around in a browser, I prefer to open a Jupyter Qt-console^[Always a nightmare to setup. Presently, I have qtconsole installed at <code class="highlighter-rouge">$HOME/.local/lib/python3.7/site-packages/qtconsole</code>. For whatever reason, I usually forget this, then install qtconsole for python 2.7 or python 3.6, then get stuck with cryptic error messages.], load a data set (which, thanks to the IPython kernel, will stay “hot in RAM”<sup id="fnref:hot"><a href="#fn:hot" class="footnote">1</a></sup>), draft functions in vim, then <code class="highlighter-rouge">%run -i</code> to bring the defined functions into the kernel. I only create a <code class="highlighter-rouge">*ipynb</code> file (i) when I am certain I can generalize my sequence of transformations of the data, and (ii) when I am satisfied that the data set is exemplar to lead into exposition. Finally, thanks to <a href="https://github.com/goerz/ipynb_notedown.vim">ipynb_notedown</a>, I can polish my argument in markdown.</p>

<p>Old: I treat Jupyter notebooks as <a href="journal-keeping">journal entries</a>. This post outlines my exposure and initial workflow in the IPython kernel as a user of <a href="https://en.wikipedia.org/wiki/SageMath">SageMath</a>.</p>

<h2 id="sage-kernel">Sage Kernel</h2>

<p>In 2016, I compiled Sage from binary. I generally opened the Jupyter notebook interface with <code class="highlighter-rouge">sage -n jupyter</code>.</p>

<p>By 2018, I realized I wanted <code class="highlighter-rouge">nbextensions</code> (namely, the <a href="https://github.com/lambdalisue/jupyter-vim-binding">jupyter-vim-binding</a>) for all my Jupyter notebooks. (See <a href="http://jupyter-contrib-nbextensions.readthedocs.io/en/latest/">“Unofficial Jupyter Notebook Extensions — jupyter_contrib_nbextensions 0.4.0 documentation”</a>.)</p>

<p>I discovered that Sage uses its own version of the Jupyter notebook, whence I needed to <a href="https://stackoverflow.com/questions/39296020/how-to-install-sagemath-kernel-in-jupyter">install sagemath as a kernel in Jupyter</a>. I followed <a href="https://stackoverflow.com/users/3827575/samuel-leli%c3%a8vre">Samuel Lelièvre</a>’s advice</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>sudo jupyter kernelspec install ./SageMath/local/share/jupyter/kernels/sagemath
</code></pre>
</div>

<blockquote>
  <p>Where SageMath is your root sagemath directory.</p>
</blockquote>

<p>On MacOS <code class="highlighter-rouge">/Applications/SageMath/</code>. Further, they advised</p>

<blockquote>
  <p>…edit the <code class="highlighter-rouge">kernel.json</code> file to make the SageMath Jupyter kernel aware of SageMath’s location, by adding <code class="highlighter-rouge">"env":{"SAGE_ROOT":"/path/to/sage"}</code> at the end of the dictionary in <code class="highlighter-rouge">kernel.json</code>.</p>

  <p>You will find the location of <code class="highlighter-rouge">kernel.json</code> by executing <code class="highlighter-rouge">jupyter kernelspec list</code>.</p>
</blockquote>

<p>My <code class="highlighter-rouge">kernel.json</code> now reads</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
 </span><span class="nt">"display_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"SageMath 8.0"</span><span class="p">,</span><span class="w"> 
 </span><span class="nt">"argv"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
  </span><span class="s2">"/Applications/SageMath/local/bin/sage"</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"--python"</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"-m"</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"sage.repl.ipython_kernel"</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"-f"</span><span class="p">,</span><span class="w"> 
  </span><span class="s2">"{connection_file}"</span><span class="p">],</span><span class="w"> 
 </span><span class="nt">"env"</span><span class="p">:{</span><span class="nt">"SAGE_ROOT"</span><span class="p">:</span><span class="s2">"/Applications/SageMath/"</span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>whence SageMath is loaded as a kernel in the (standard) Jupyter Notebook.</p>

<h2 id="version-control">Version Control</h2>

<p>How should I curate individual notebooks? By subject? By date? By most recently updated?</p>

<p>On one hand, I could follow <a href="https://svds.com/jupyter-notebook-best-practices-for-data-science/">Jonathan Whitmore</a>’s suggestion - be verbose!</p>

<blockquote>
  <p>Let a traditional paper lab notebook be your guide here:</p>

  <ul>
    <li>Each notebook keeps a historical (and dated) record of the analysis as it’s being explored.</li>
    <li>The notebook is not meant to be anything other than a place for experimentation and development.</li>
    <li>Each notebook is controlled by a single author: a data scientist on the team (marked with initials).</li>
    <li>Notebooks can be split when they get too long.</li>
    <li>Notebooks can be split by topic, if it makes sense.</li>
  </ul>
</blockquote>

<p>Yet, I have no one in mind as an imagined reader. I might as well get notebooks
configured in a way that would be useful for a data-analytic “reading”. As in,
which did I return to edit most frequently? which were referenced for code most
often? least often?</p>

<p>Thinking about <a href="http://pgbovine.net/PG-Podcast-35-Audrey-Boguchwal-and-Nadia-Eghbal.htm">“Philip Guo - PG Podcast - Episode 35 - Audrey Boguchwal + Nadia Eghbal on sustainable online communities”</a>, right now, I want neither to add noise to an online community nor hear it. It seems more beneficial to use notebooks to (i) build mechanical skill, and (ii) develop intuition, than to write for an audience.</p>

<p>Consequently, I’m following <a href="http://timstaley.co.uk/posts/making-git-and-jupyter-notebooks-play-nice/">Tim Saley</a>’s advice: strip notebooks of outputs and metadata for version control.</p>

<p>Because I occasionally run <code class="highlighter-rouge">sagemath</code> and <code class="highlighter-rouge">mit-scheme</code> as kernels for REPL style computations, I’ll only remove metadata from the individual cells.</p>

<p>I’ve set a <a href="https://git-scm.com/docs/gitattributes#__code_filter_code">filter</a> to clean <code class="highlighter-rouge">*.ipynb</code> files in any of my git repos with <a href="https://stedolan.github.io/jq/">jq</a>.</p>

<p>In my <code class="highlighter-rouge">~/.gitconfig</code></p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="o">[</span>core]
attributesfile <span class="o">=</span> ~/.gitattributes_global

<span class="o">[</span>filter <span class="s2">"nbstrip_full"</span><span class="o">]</span>
clean <span class="o">=</span> <span class="s2">"jq --indent 1 </span><span class="se">\</span><span class="s2">
        '(.cells[] | select(has(</span><span class="se">\"</span><span class="s2">outputs</span><span class="se">\"</span><span class="s2">)) | .outputs) = []  </span><span class="se">\</span><span class="s2">
        | (.cells[] | select(has(</span><span class="se">\"</span><span class="s2">execution_count</span><span class="se">\"</span><span class="s2">)) | .execution_count) = null  </span><span class="se">\</span><span class="s2">
        | .cells[].metadata = {} </span><span class="se">\</span><span class="s2">
        '"</span>
smudge <span class="o">=</span> cat
required <span class="o">=</span> <span class="nb">true</span>
</code></pre>
</div>

<p>and then in my <code class="highlighter-rouge">~/.gitattributes_global</code></p>

<div class="language-config highlighter-rouge"><pre class="highlight"><code>*.<span class="n">ipynb</span> <span class="n">filter</span>=<span class="n">nbstrip_full</span>
</code></pre>
</div>

<h2 id="meta">meta</h2>

<p>Similar to my activities feeds, I’ve flattened the directory tree for notebooks. I have no doubt an organization beyond chronology will fall out.</p>

<p>In a sociological analog, from <a href="https://www.wired.com/2014/03/tyranny-flatness/">Why Workers Can Suffer in Bossless Companies Like GitHub</a>, we have</p>

<blockquote>
  <p>Critics say flat organizations can conceal power structures and shield individuals from accountability. This idea dates to the 1972 essay <em><a href="http://www.jofreeman.com/joreen/tyranny.htm">The Tyranny of Structurelessness</a></em> by Jo Freeman, who describes her experiences in “leaderless” feminist organizations in the 1960s. “There is no such thing as a structureless group,” Freeman wrote. “Any group of people of whatever nature that comes together for any length of time for any purpose will inevitably structure itself in some fashion.”</p>
</blockquote>

<h2 id="see-also">see also</h2>

<ul>
  <li><a href="http://jupyter-notebook.readthedocs.io/en/latest/extending/savehooks.html">file save hooks</a> to pretty print “deliverable” notebooks.</li>
  <li><a href="http://doc.sagemath.org/html/en/reference/repl/sage/repl/ipython_kernel/install.html">Installing the SageMath Jupyter Kernel and Extensions</a></li>
  <li><a href="http://jupyter-client.readthedocs.io/en/stable/kernels.html">Making Kernels for Jupyter</a></li>
  <li>Ch. 2, <a href="http://doc.sagemath.org/pdf/en/installation/installation.pdf">“Sage Installation Guide”</a></li>
</ul>
<div class="footnotes">
  <ol>
    <li id="fn:hot">
      <p><a href="http://pgbovine.net/PG-Vlog-145-python-r-data-analysis-setup.htm">“Philip Guo - PG Vlog #145 - Python + R Data Analysis Setup”</a>. Retrieved July 16, 2018.&nbsp;<a href="#fnref:hot" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>


  </main>

<footer>
<p align="right" xmlns:dct="http://purl.org/dc/terms/" xmlns:vcard="http://www.w3.org/2001/vcard-rdf/3.0#">
  Licensed as 
  <a href="https://en.wikipedia.org/wiki/Creative%20Commons" title="Wikipedia: Creative Commons">Creative Commons</a> 
  <a href="http://creativecommons.org/about/cc0">public domain (CC-0)</a> by Colton Grainger.
</p>
</footer> <script>
    anchors.add();
  </script>
</body>
</html>

